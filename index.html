<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DIP Calculator v1.7</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

<!-- ✅ ADD TO HOME SCREEN (iPad / iPhone) -->
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<meta name="apple-mobile-web-app-title" content="DIP Calculator">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- ✅ END ADD TO HOME SCREEN -->

<style>
  body{
    font-family:-apple-system,BlinkMacSystemFont,Arial,sans-serif;
    background:#0b1220;
    color:#eef2ff;
    margin:0;
    padding:16px;
    display:flex;
    justify-content:center;
  }
  .app{
    width:100%;
    max-width:760px;
    background:#121a2b;
    border-radius:16px;
    padding:16px;
    border:1px solid rgba(255,255,255,.12);
  }

  /* HEADER */
  .header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
  }
  h1{ margin:0; letter-spacing:.6px; }
  .today{
    font-size:12px;
    color:#ffffff;
    border:1px solid rgba(255,255,255,.25);
    padding:6px 10px;
    border-radius:999px;
    background:rgba(255,255,255,.12);
    white-space:nowrap;
  }

  label{
    display:block;
    margin-top:12px;
    font-weight:800;
    color:#ffffff;
  }

  input{
    padding:12px;
    font-size:18px;
    border-radius:10px;
    border:1px solid rgba(255,255,255,.25);
    background:#1c2540;
    color:#fff;
    outline:none;
  }
  input:focus{
    box-shadow:0 0 0 4px rgba(122,162,255,.45);
    border-color:transparent;
  }

  .input-date{ width:220px; }
  .input-small{ width:140px; }

  .hint{
    font-size:12px;
    color:rgba(255,255,255,.75);
    margin-top:4px;
  }

  .block{
    margin-top:16px;
    padding:12px;
    border:1px solid rgba(255,255,255,.18);
    border-radius:12px;
    background:rgba(255,255,255,.05);
  }
  .blockTitle{
    font-weight:900;
    font-size:13px;
    margin-bottom:8px;
  }

  .actionLine{
    display:flex;
    align-items:center;
    gap:12px;
    flex-wrap:nowrap;
  }

  button.check{
    padding:12px 18px;
    font-size:16px;
    font-weight:950;
    border-radius:10px;
    border:none;
    background:#ffffff;
    color:#0b1220;
    cursor:pointer;
    min-width:170px;
  }

  /* SUMMARY AREA */
  .summary{
    margin-left:auto;
    display:flex;
    align-items:center;
    gap:8px;
  }

  .summaryBox{
    min-width:230px;
    max-width:230px;
    border-radius:10px;
    padding:10px;
    display:none;
    color:#ffffff;
    font-weight:900;
  }
  .summaryBox.show{ display:block; }

  .summary-ok{ background:#0f8f4f; }
  .summary-bad{ background:#b00020; }
  .summary-warn{ background:#b37a00; }

  .statusLine{
    font-size:14px;
    letter-spacing:.4px;
    line-height:1.1;
  }

  .dates{
    margin-top:4px;
    font-size:12px;
    font-weight:700;
    line-height:1.2;
  }

  /* RESET */
  .resetLink{
    border:none;
    background:transparent;
    color:rgba(238,242,255,.65);
    font-size:12px;
    font-weight:800;
    cursor:pointer;
    padding:6px 8px;
    border-radius:8px;
    white-space:nowrap;
  }
  .resetLink:hover{
    color:#ffffff;
    background:rgba(255,255,255,.12);
  }

  .resetAllWrap{
    display:flex;
    justify-content:flex-end;
    margin-top:12px;
  }
</style>
</head>

<body>
<div class="app">

  <div class="header">
    <h1>DIP CALCULATOR</h1>
    <div class="today" id="todayBadge"></div>
  </div>

  <!-- ✅ form wrapper helps iOS standalone keyboard behavior -->
  <form onsubmit="return false;">
    <label>Part Expiration Date</label>
    <input
      type="text"
      id="expiration"
      class="input-date"
      placeholder="MM/DD/YYYY"
      inputmode="numeric"
      pattern="[0-9]*"
      autocomplete="off"
      autocorrect="off"
      autocapitalize="off"
      spellcheck="false"
      maxlength="10"
    >
    <div class="hint">Type numbers only. Slashes are added automatically.</div>

    <!-- DAYS -->
    <div class="block">
      <div class="blockTitle">Days to calculate</div>
      <div class="actionLine">
        <input
          type="text"
          id="days"
          class="input-small"
          placeholder="e.g., 320"
          inputmode="numeric"
          pattern="[0-9]*"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
        >
        <button class="check" type="button" onclick="check('days')">CHECK (DAYS)</button>
        <div class="summary">
          <div id="summary-days" class="summaryBox"></div>
          <button class="resetLink" type="button" onclick="resetBlock('days')">Reset</button>
        </div>
      </div>
    </div>

    <!-- MONTHS -->
    <div class="block">
      <div class="blockTitle">Months to calculate</div>
      <div class="actionLine">
        <input
          type="text"
          id="months"
          class="input-small"
          placeholder="e.g., 6"
          inputmode="numeric"
          pattern="[0-9]*"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
        >
        <button class="check" type="button" onclick="check('months')">CHECK (MONTHS)</button>
        <div class="summary">
          <div id="summary-months" class="summaryBox"></div>
          <button class="resetLink" type="button" onclick="resetBlock('months')">Reset</button>
        </div>
      </div>
    </div>

    <!-- YEARS -->
    <div class="block">
      <div class="blockTitle">Years to calculate</div>
      <div class="actionLine">
        <input
          type="text"
          id="years"
          class="input-small"
          placeholder="e.g., 1"
          inputmode="numeric"
          pattern="[0-9]*"
          autocomplete="off"
          autocorrect="off"
          autocapitalize="off"
          spellcheck="false"
        >
        <button class="check" type="button" onclick="check('years')">CHECK (YEARS)</button>
        <div class="summary">
          <div id="summary-years" class="summaryBox"></div>
          <button class="resetLink" type="button" onclick="resetBlock('years')">Reset</button>
        </div>
      </div>
    </div>

    <div class="resetAllWrap">
      <button class="resetLink" type="button" onclick="resetAll()">Reset all</button>
    </div>
  </form>

</div>

<script>
  function startOfToday(){
    const d = new Date();
    d.setHours(0,0,0,0);
    return d;
  }
  document.getElementById("todayBadge").textContent =
    "Today: " + startOfToday().toLocaleDateString("en-US");

  // ✅ iOS standalone keyboard fix: force focus on touch/click
  function forceFocus(el){
    try { el.focus({ preventScroll: true }); } catch(e){ el.focus(); }
    // Ensure it’s visible; helps iOS decide to show the keyboard
    setTimeout(() => {
      try { el.scrollIntoView({ block: "center", inline: "nearest" }); } catch(e){}
    }, 0);
  }

  function bindKeyboardFix(id){
    const el = document.getElementById(id);
    if(!el) return;

    // touchend is the most reliable for iOS
    el.addEventListener("touchend", (ev) => {
      ev.preventDefault();
      forceFocus(el);
    }, { passive: false });

    // fallback for click
    el.addEventListener("click", () => forceFocus(el));
  }

  ["expiration","days","months","years"].forEach(bindKeyboardFix);

  // Expiration date mask MM/DD/YYYY
  const expInput = document.getElementById("expiration");
  expInput.addEventListener("input", e=>{
    const d = e.target.value.replace(/\D/g,"").slice(0,8);
    e.target.value = d.replace(/^(\d{2})(\d)/,"$1/$2")
                      .replace(/^(\d{2}\/\d{2})(\d)/,"$1/$2");
  });

  function parseUSDate(v){
    const m = /^(\d{2})\/(\d{2})\/(\d{4})$/.exec(v);
    if(!m) return null;
    const d = new Date(+m[3], +m[1]-1, +m[2]);
    if(d.getMonth() !== (+m[1]-1) || d.getDate() !== +m[2]) return null;
    d.setHours(0,0,0,0);
    return d;
  }

  function add(date, amount, unit){
    const d = new Date(date);
    if(unit==="days") d.setDate(d.getDate()+amount);
    if(unit==="months") d.setMonth(d.getMonth()+amount);
    if(unit==="years") d.setFullYear(d.getFullYear()+amount);
    d.setHours(0,0,0,0);
    return d;
  }

  function renderSummary(unit, type, exp, calc, message){
    const box = document.getElementById("summary-" + unit);
    box.className = "summaryBox show summary-" + type;
    box.innerHTML = type === "warn"
      ? `<div class="statusLine">${message}</div>`
      : `<div class="statusLine">${message}</div>
         <div class="dates">
           Calc: ${calc.toLocaleDateString("en-US")}<br>
           Exp: ${exp.toLocaleDateString("en-US")}
         </div>`;
  }

  function getNumericValue(id){
    const raw = (document.getElementById(id).value || "").trim();
    if(raw === "") return NaN;
    if(!/^\d+$/.test(raw)) return NaN;
    return Number(raw);
  }

  function check(unit){
    const exp = parseUSDate(expInput.value.trim());
    const amount = getNumericValue(unit);

    if(!exp) return renderSummary(unit,"warn",null,null,"Invalid date");
    if(!Number.isFinite(amount) || amount < 0)
      return renderSummary(unit,"warn",null,null,"Invalid number");

    const calc = add(startOfToday(), Math.floor(amount), unit);
    exp < calc
      ? renderSummary(unit,"bad",exp,calc,"CREATE A DIP")
      : renderSummary(unit,"ok",exp,calc,"OK");
  }

  function resetBlock(unit){
    document.getElementById(unit).value = "";
    const box = document.getElementById("summary-" + unit);
    box.className = "summaryBox";
    box.innerHTML = "";
  }

  function resetAll(){
    expInput.value = "";
    ["days","months","years"].forEach(u => resetBlock(u));
    forceFocus(expInput);
  }
</script>
</body>
</html>
